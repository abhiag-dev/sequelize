<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Menu</title>
<link rel="stylesheet" href="menu.css">
<style>
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}
th {
    background-color: #f2f2f2;
}
label {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
}
</style>
</head>
<body>

<h2>Menu Items</h2>
<label id="categoryLabel">All Items</label>
<table id="menuTable">
  <thead>
    <tr>
      <th>Name</th>
      <th>Price</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
 
  </tbody>
</table>

<button id="showMenuBtn">Show Menu</button> 
<button onclick="filterMenu('veg')">Veg Items</button>
<button onclick="filterMenu('non-veg')">Non-Veg Items</button>
<button id="addMenuItemBtn">Add Menu Item</button>

<form id="addMenuItemForm" style="display: none;">
  <input type="number" id="idInput" placeholder="id" required>
  <input type="text" id="nameInput" placeholder="Name" required>
  <input type="number" id="priceInput" placeholder="Price" required>
  <input type="text" id="descriptionInput" placeholder="Description" required>
  <input type="text" id="categoryInput" placeholder="Category Name" required>
  <button type="button" id="submitMenuItemBtn">Add Menu Item</button>
</form>

<script>
document.getElementById("showMenuBtn").addEventListener("click", function() {
  fetch('/api/menu')
    .then(response => response.json())
    .then(menu => {
      const menuTable = document.getElementById('menuTable');
      const tbody = menuTable.querySelector('tbody');

      tbody.innerHTML = '';

      menu.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.description}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(error => console.error('Error fetching menu:', error));
});

document.getElementById("addMenuItemBtn").addEventListener("click", function() {
  document.getElementById("addMenuItemForm").style.display = "block";
});

function filterMenu(category) {
  fetch(`/api/menu-items?category=${category}`)
    .then(response => response.json())
    .then(menu => {
      const menuTable = document.getElementById('menuTable');
      const tbody = menuTable.querySelector('tbody');

      tbody.innerHTML = '';

      menu.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.description}</td>
        `;
        tbody.appendChild(row);
      });
      // Set the category label text dynamically
      document.getElementById('categoryLabel').innerText = category === 'veg' ? 'Veg Items' : 'Non-Veg Items';
    })
    .catch(error => console.error('Error fetching menu:', error));
}

document.getElementById("submitMenuItemBtn").addEventListener("click", function() {
  const id = document.getElementById("idInput").value;
  const name = document.getElementById("nameInput").value;
  const price = document.getElementById("priceInput").value;
  const description = document.getElementById("descriptionInput").value;
  const category_name = document.getElementById("categoryInput").value;

  fetch('/api/add-menu', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      "id": id,
      "name": name,
      "price": price,
      "description": description,
      "category_name": category_name
    })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Failed to add menu item');
    }
    return response.json();
  })
  .then(data => {
    console.log('Menu item added successfully:', data);
    location.reload();
  })
  .catch(error => {
    console.error('Error adding menu item:', error);
  });
});

window.addEventListener("load", function() {
  document.getElementById("showMenuBtn").click();
});

</script>

</body>
</html>
